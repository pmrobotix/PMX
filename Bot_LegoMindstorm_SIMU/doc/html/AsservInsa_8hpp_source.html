<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TEST: /home/pmx/git/PMX/src/Asserv.Insa/AsservInsa.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TEST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_127edb8a59ea03a47519e357c8de93c4.html">Asserv.Insa</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AsservInsa.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifndef COMMON_ASSERVINSA_ASSERVINSA_HPP_</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#define COMMON_ASSERVINSA_ASSERVINSA_HPP_</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//#define DEBUG_MOTION 1</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;pthread.h&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;semaphore.h&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;../Common/Asserv/Asserv.hpp&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;../Log/LoggerFactory.hpp&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;../Thread/Thread.hpp&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;../Common/Position.hpp&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">struct </span><a class="code" href="structPosition.html">Position</a>;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">class </span><a class="code" href="classRobot.html">Robot</a>;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">struct </span><a class="code" href="structRobotPosition.html">RobotPosition</a>;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">class </span><a class="code" href="classMovingBase.html">MovingBase</a>;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//# define M_E      2.7182818284590452354   /* e */</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//# define M_LOG2E  1.4426950408889634074   /* log_2 e */</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">//# define M_LOG10E 0.43429448190325182765  /* log_10 e */</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">//# define M_LN2        0.69314718055994530942  /* log_e 2 */</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//# define M_LN10       2.30258509299404568402  /* log_e 10 */</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">//# define M_PI     3.14159265358979323846  /* pi */</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//# define M_PI_2       1.57079632679489661923  /* pi/2 */</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">//# define M_PI_4       0.78539816339744830962  /* pi/4 */</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">//# define M_1_PI       0.31830988618379067154  /* 1/pi */</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//# define M_2_PI       0.63661977236758134308  /* 2/pi */</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">//# define M_2_SQRTPI   1.12837916709551257390  /* 2/sqrt(pi) */</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//# define M_SQRT2  1.41421356237309504880  /* sqrt(2) */</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">//# define M_SQRT1_2    0.70710678118654752440  /* 1/sqrt(2) */</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor"># define M_2PI (2*M_PI)</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">//#define DEBUG_MOTION</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">//#define DEBUG_ENCODER</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">//#define DEBUG_PID</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">//#define LOG_PID</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//#define LOG_SVG_APPENDER //log c++ pour activer le SVG</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//#define LOG_PID_APPENDER  //log c++ pour activer le fileAppender</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#define uint8 unsigned char</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#define uint16 unsigned short</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#define uint32 unsigned int</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#define int8 char</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#define int16 short</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#define int32 int</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#define BOOL bool</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#define FALSE false</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#define TRUE true</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#define slippageThreshold 10</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#define MAX_PID_SYSTEM_NUMBER   6</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">//every N period, we compute precise values for</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">//cos and sin of the robot angle</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#define PRECISE_COMPUTATION_NTH_PERIOD      64</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#define MAX_PERIOD      128</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">//LEFT - RIGHT</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#define LEFT_MOTOR      0</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#define RIGHT_MOTOR     1</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">//ALPHA - DELTA (virtual motors)</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#define ALPHA_MOTOR     0</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#define DELTA_MOTOR     1</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">//Two motors per set</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#define MOTOR_PER_TYPE  2</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">//Number of period used to compute motor speed</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#define MOTOR_SPEED_PERIOD_NB   9</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">//motion_priv.hpp</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"></span><span class="preprocessor">#define CORRECT_DELTA_OVERFLOW(value, max_value) {if((value)&gt;(max_value/2))value-=max_value; else if((value)&lt;(-(max_value/2)))value+=max_value;}</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#define BOUND_INT(value, max_abs) {if(value&gt;max_abs)value=max_abs; else if(value&lt;-max_abs)value=-max_abs;}</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">//PID system are identified by a number</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">typedef</span> uint8 PID_SYSTEM;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">typedef enum</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">{</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">    TRAJECTORY_RUNNING,</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">    ASSISTED_HANDLING,</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">    FREE_MOTION,</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">    DISABLE_PID,</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">} MOTION_STATE;*/</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">typedef enum</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">{</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">    TRAJ_OK,                //trajectory successfully completed</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">    TRAJ_ERROR,             //unknown error (not implemented !)</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">    TRAJ_COLLISION,         //trajectory interrupted because of a collision</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">    TRAJ_NEAR_OBSTACLE,     //trajectory interrupted because of a near collision</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">    TRAJ_CANCELLED,         //trajectory cancelled by remote user (for debug only)</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">    TRAJ_INTERRUPTED,       //trajectory interrupted by software</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">    TRAJ_COLLISION_REAR</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">} TRAJ_STATE;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">//different kind of command generation</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    POSITION_COMMAND,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    SPEED_COMMAND,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    STEP_COMMAND,</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;} MOTOR_COMMAND_TYPE;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">//different kind of command interpretation (virtual motors)</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    LEFT_RIGHT,</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    ALPHA_DELTA,</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    MAX_MOTION_CONTROL_TYPE_NUMBER,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;} MOTION_CONTROL_TYPE;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">//structure used to stock configuration values of the PID system</span></div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="structpidConfig.html">  133</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">float</span> kP;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">float</span> kI;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">float</span> kD;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;} <a class="code" href="structpidConfig.html">pidConfig</a>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="structpidSystemValues.html">  140</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="structpidConfig.html">pidConfig</a> conf;                 <span class="comment">//pid system configuration</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lastTime;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">float</span> lastInput;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">float</span> lastOutput;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">float</span> ITerm;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;} <a class="code" href="structpidSystemValues.html">pidSystemValues</a>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">//possible phase of a position trajectory :</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;{</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    TR_PRE_PHASE,           <span class="comment">//trajectory not yet started</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    TR_ACCEL_PHASE,         <span class="comment">//0 - acceleration phase to reach goal speed</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    TR_CONSTANT_PHASE,      <span class="comment">//1 - motor has reached final speed</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    TR_DECEL_PHASE,     <span class="comment">//2 - deceleration phase before reaching goal position</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    TR_END_PHASE,           <span class="comment">//3 - motor has reached desired position</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;} TRAJ_PHASE;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">//precomputed values defining the complete trajectory</span></div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="structPositionCommand.html">  160</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;{</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    TRAJ_PHASE phase;       <span class="comment">//current phase</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    int32 period0;          <span class="comment">//period number of the start of trajectory</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    int32 order0;           <span class="comment">//motor position at trajectory start</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    int32 VMax;             <span class="comment">//goal speed in vTops/sample</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    int32 order3;           <span class="comment">//goal position</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    int32 T01;              <span class="comment">//number of sample between accel and constant phase</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    int32 T12;              <span class="comment">//number of sample between contant and decel phase</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    int32 T23;              <span class="comment">//number of sample between decel and end phase</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    int32 <a class="code" href="classAcceleration.html">Acceleration</a>; <span class="comment">//acceleration used in movement in vTops/sample/sample</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    int32 Deceleration; <span class="comment">//deceleration used in movement in vTops/sample/sample</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    int32 lastOrder;        <span class="comment">//current ordered position of motor</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;} <a class="code" href="structPositionCommand.html">PositionCommand</a>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">//possible phase of a speed trajectory :</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;{</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    SP_PRE_PHASE,           <span class="comment">//trajectory not yet started</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    SP_ACCEL_PHASE, <span class="comment">//acceleration (or deceleration) phase to reach goal speed</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    SP_CONSTANT_PHASE,      <span class="comment">//motor has reached final speed</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    SP_END_PHASE,           <span class="comment">//trajectory ended</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;} SPEED_PHASE;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">//precomputed values defining the complete trajectory</span></div><div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="structSpeedCommand.html">  190</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    SPEED_PHASE phase;      <span class="comment">//current phase</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    int32 order0;           <span class="comment">//motor position at trajectory start</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    int32 period0;          <span class="comment">//nb of period at the start of trajectory</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    int32 period1;          <span class="comment">//nb of period at end of acceleration (deceleration)</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    int32 period2;          <span class="comment">//nb of period at end of trajectory</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    int32 <a class="code" href="classAcceleration.html">Acceleration</a>;     <span class="comment">//acceleration used in movement in vTops/sample/sample</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    int32 V0;               <span class="comment">//start speed in vTops/sample</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    int32 VGoal;            <span class="comment">//goal speed in vTops/sample</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    int32 lastOrder;        <span class="comment">//current ordered position of motor</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;} <a class="code" href="structSpeedCommand.html">SpeedCommand</a>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keyword">typedef</span> int32 StepCommand;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="structMOTOR.html">  212</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;{</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    PID_SYSTEM PIDSys;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    int32 lastPos;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordtype">int</span> posIndex;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    int32 prevPos[MOTOR_SPEED_PERIOD_NB];       <span class="comment">//previous value of position for speed computation</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;} <a class="code" href="structMOTOR.html">MOTOR</a>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;{</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    WP_NOT_SET,             <span class="comment">//no waypoint set for the moment</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    WP_POS_ALPHA_SUPERIOR,  <span class="comment">//waypoint triggered when alpha value is above threshold value</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    WP_POS_ALPHA_INFERIOR,  <span class="comment">//waypoint triggered when alpha value is below threshold value</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    WP_POS_DELTA_SUPERIOR,  <span class="comment">//waypoint triggered when delta value is above threshold value</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    WP_POS_DELTA_INFERIOR,  <span class="comment">//waypoint triggered when delta value is below threshold value</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    WP_END_OF_TRAJ,         <span class="comment">//waypoint when both motor command are finished</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;} WAYPOINT_TYPE;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="structWAYPOINT.html">  236</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    WAYPOINT_TYPE type;int32 threshold;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;} <a class="code" href="structWAYPOINT.html">WAYPOINT</a>;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="structRobotCommand.html">  242</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;{</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    MOTOR_COMMAND_TYPE cmdType;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    MOTION_CONTROL_TYPE mcType;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">//anonymous union that stock data structure for every possible type of motor command</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">//structures share the same memory (which you can interpret as needed)</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keyword">union</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <a class="code" href="structPositionCommand.html">PositionCommand</a> posCmd[MOTOR_PER_TYPE];</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <a class="code" href="structSpeedCommand.html">SpeedCommand</a> speedCmd[MOTOR_PER_TYPE];</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        StepCommand stepCmd[MOTOR_PER_TYPE];</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    } cmd;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;} <a class="code" href="structRobotCommand.html">RobotCommand</a>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="classAsservInsa.html">  258</a></span>&#160;<span class="keyword">class </span><a class="code" href="classAsservInsa.html">AsservInsa</a>: <span class="keyword">public</span> <a class="code" href="classutils_1_1Thread.html">utils::Thread</a></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="keyword">protected</span>:</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a67295285fc3a26cb25c99a1f9a88db2c">execute</a>();</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="classlogs_1_1Logger.html">logs::Logger</a> &amp; logger()</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classlogs_1_1Logger.html">logs::Logger</a> &amp; instance = <a class="code" href="classlogs_1_1LoggerFactory.html#a82585b5de73e471e06cafdccc3b3721e">logs::LoggerFactory::logger</a>(<span class="stringliteral">&quot;AsservInsa&quot;</span>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">return</span> instance;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">//  static inline const logs::Logger &amp; loggerSvg()</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">//  {</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">//      static const logs::Logger &amp; instance = logs::LoggerFactory::logger(&quot;Svg4AsservInsa&quot;);</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">//      return instance;</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">//  }</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment"></span>    <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="classlogs_1_1Logger.html">logs::Logger</a> &amp; loggerFile()</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classlogs_1_1Logger.html">logs::Logger</a> &amp; instance = <a class="code" href="classlogs_1_1LoggerFactory.html#a82585b5de73e471e06cafdccc3b3721e">logs::LoggerFactory::logger</a>(<span class="stringliteral">&quot;logFileAsservInsa&quot;</span>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">return</span> instance;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordtype">int</span> oldPwmLeft;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordtype">int</span> oldPwmRight;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordtype">int</span> stop_motion_ITTask;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">//bool activate_;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    int32 rightTicksPerM_;int32 leftTicksPerM_;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">int</span> useExternalEncoders_;int32 lastLeft_;int32 lastRight_;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">//encoder.c</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">//ratio vTops/ticks for left encoder</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    int32 leftEncoderRatio;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">//ratio vTops/ticks for right encoder</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    int32 rightEncoderRatio;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">//distance between both encoder wheels in vTops</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    int32 distEncoder;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">//distance between both encoder wheels in meters</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">float</span> distEncoderMeter;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">float</span> valueVTops; <span class="comment">// [meter/vTops]</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordtype">int</span> defaultSamplingFreq;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">//float valueSample; //[sec/sample] //remplacer par loopDelayInMillis</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">long</span> loopDelayInMillis;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">//int SampleTime; //... millisec</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    int32 vtopsPerTicks; <span class="comment">//Sample per ticks</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordtype">int</span> maxPwmValue_;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordtype">float</span> defaultVmax; <span class="comment">//m/sec</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordtype">float</span> defaultAcc;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">float</span> defaultDec;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordtype">long</span> <span class="keywordtype">long</span> timeOffset;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">//nb of period since the beginning</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    uint32 periodNb; <span class="comment">//static</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">//mutex protecting the currently executed command</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    pthread_mutex_t mtxMotionCommand; <span class="comment">//static</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">//pthread_t thread; //static</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">//the currently executed command</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="structRobotCommand.html">RobotCommand</a> motionCommand; <span class="comment">//static</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <a class="code" href="structpidSystemValues.html">pidSystemValues</a> systemValues[MAX_PID_SYSTEM_NUMBER];</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">//number of system created so far</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    PID_SYSTEM pid_Nb;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">//well, genericity isn&#39;t always optimisation-friendly...</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordtype">long</span> stopAt; <span class="comment">//static</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="structWAYPOINT.html">WAYPOINT</a> nextWaypoint;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordtype">bool</span> waitingSemaphore; <span class="comment">//static</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    sem_t semWaypoint; <span class="comment">//static</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    TRAJ_STATE trajState; <span class="comment">//static</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordtype">float</span> Theta;                    <span class="comment">//rad //static</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordtype">float</span> cosTheta, sinTheta;   <span class="comment">//no unit //static</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordtype">float</span> xTops, yTops;     <span class="comment">//encoder vTops //static</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">//float pos_x; //static</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">//float pos_y; //static</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">//float pos_theta; //static</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    int32 odoPeriodNb; <span class="comment">//static</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    int32 slippage[MOTOR_PER_TYPE];             <span class="comment">//current slippage //static</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    int32 values[MOTOR_PER_TYPE][MAX_PERIOD];       <span class="comment">//all the previous values of slippage //static</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    int32 index[MOTOR_PER_TYPE];                    <span class="comment">//index in the values table //static</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="structRobotCommand.html">RobotCommand</a> cmd; <span class="comment">//static</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    MOTION_STATE RobotMotionState;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">//Base roulante de ce robot</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="structMOTOR.html">MOTOR</a> motors[MAX_MOTION_CONTROL_TYPE_NUMBER][MOTOR_PER_TYPE];</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">//MovingBase *base_;</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="classRobot.html">Robot</a> * robot_;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">//cap correction</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">//float cap_theta_init_;</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordtype">bool</span> cap_enabled_;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordtype">bool</span> cap_enabled_line;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordtype">float</span> goal_pos_x_m;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordtype">float</span> goal_pos_y_m;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">//---clothoid</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordtype">float</span> FresnelCSSqrt(<span class="keywordtype">float</span> x);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordtype">float</span> FresnelSSqrt(<span class="keywordtype">float</span> x);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">void</span> CreateTwoSegmentTraj(<span class="keywordtype">float</span> V0,</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordtype">float</span> distD1,</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordtype">float</span> distD2,</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="keywordtype">float</span> A0,</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keywordtype">float</span> beta,</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordtype">float</span> epsilon);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">//---motion</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordtype">void</span> checkRobotCommand(<a class="code" href="structRobotCommand.html">RobotCommand</a> *cmd);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordtype">void</span> loadCommand(<a class="code" href="structRobotCommand.html">RobotCommand</a> *cmd);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="comment">//motion control task</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordtype">void</span> initPWM(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordtype">void</span> signalEndOfTraj(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">//---motor_PID</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> pid_Init(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    PID_SYSTEM pid_Create(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordtype">void</span> pid_Config(PID_SYSTEM system, <span class="keywordtype">float</span> kp, <span class="keywordtype">float</span> ki, <span class="keywordtype">float</span> kd);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordtype">float</span> pid_Compute(PID_SYSTEM system, <span class="keywordtype">float</span> setpoint, <span class="keywordtype">float</span> input, <span class="keywordtype">float</span> speed);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    int32 pid_Compute_rcva_chaff(PID_SYSTEM system, int32 error, <span class="keywordtype">double</span> vitesse);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    int32 pid_ComputeRcva(PID_SYSTEM system, <span class="keywordtype">float</span> error, <span class="keywordtype">float</span> vitesse);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">//---motor_positionCommand</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keywordtype">void</span> ComputePositionCommand(<a class="code" href="structPositionCommand.html">PositionCommand</a> *out_command,</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    int32 dist,</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    int32 VMax,</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    int32 Accel,</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    int32 Decel);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">void</span> LoadPositionCommand(<a class="code" href="structPositionCommand.html">PositionCommand</a> *out_command, <a class="code" href="structMOTOR.html">MOTOR</a> *motor,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    int32 periodNb);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordtype">bool</span> GetPositionOrder(<a class="code" href="structPositionCommand.html">PositionCommand</a> *posCommand,</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    int32 Tn,</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    int32 *out_Order);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">//---motor_speedCommand</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordtype">void</span> ComputeSpeedCommand(<a class="code" href="structSpeedCommand.html">SpeedCommand</a> *out_command,</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    int32 V0,</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    int32 VGoal,</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    int32 distMax,</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    int32 Accel);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordtype">void</span> ComputeSpeedCommandTime(<a class="code" href="structSpeedCommand.html">SpeedCommand</a> *out_command,</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    int32 V0,</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    int32 Time,</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    int32 Accel);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordtype">void</span> ComputeSpeedCommandMaxTime(<a class="code" href="structSpeedCommand.html">SpeedCommand</a> *out_command,</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    int32 V0,</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    int32 VGoal,</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    int32 Accel,</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    int32 Time);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordtype">void</span> LoadSpeedCommand(<a class="code" href="structSpeedCommand.html">SpeedCommand</a> *out_cmd, int32 lastPos, int32 periodNb);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordtype">bool</span> GetSpeedOrder(<a class="code" href="structSpeedCommand.html">SpeedCommand</a> *speedCommand, int32 Tn,</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    int32 *out_order);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">//---motor_stepCommand</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordtype">void</span> ComputeStepOrder(StepCommand *out_command, int32 steporder, <span class="keywordtype">int</span> seconds);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordtype">bool</span> GetStepOrder(StepCommand *order, int32 *out_order);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">//---motor</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordtype">void</span> initMotor(<a class="code" href="structMOTOR.html">MOTOR</a> *motor);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">//config iMax for all motors</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="comment">//void motors_ConfigAllIMax(int32 imax);</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> updateMotor(<a class="code" href="structMOTOR.html">MOTOR</a> *motor, int32 delta);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    int32 getMotorSpeed(<a class="code" href="structMOTOR.html">MOTOR</a> *motor);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">//---path_manager</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordtype">void</span> path_SetNextWaypoint(<a class="code" href="structWAYPOINT.html">WAYPOINT</a> *wp);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    TRAJ_STATE path_WaitWaypoint(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    TRAJ_STATE path_WaitEndOfTrajectory(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordtype">void</span> path_LaunchTrajectory(<a class="code" href="structRobotCommand.html">RobotCommand</a> *traj);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordtype">void</span> path_Init(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordtype">void</span> path_TriggerWaypoint(TRAJ_STATE <a class="code" href="classutils_1_1Thread.html#ada9233f3e669c925e9ed518201ad31cd">state</a>);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">//---robot_odometry</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordtype">void</span> odo_Integration(<span class="keywordtype">float</span> dTheta, <span class="keywordtype">float</span> dV);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordtype">void</span> odo_GetPositionXYTheta(<span class="keywordtype">float</span> *x, <span class="keywordtype">float</span> *y, <span class="keywordtype">float</span> *theta);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">//---robot_slippage</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordtype">void</span> slippage_Init(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="keywordtype">void</span> slippage_Update(<span class="keywordtype">int</span> motor, int32 dWheel, int32 dRobot);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordtype">void</span> resetSlippage(<span class="keywordtype">int</span> motor);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">//---robot_unitconversion</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// The following functions are helpers for convertion between units used</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// in the motion control program :</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">//vTops is a virtual measure distance to avoid floating point computation</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">//sample is a time unit corresponding to one motion control period</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    int32 convertDistTovTops(<span class="keywordtype">float</span> dist);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    int32 convertSpeedTovTopsPerPeriod(<span class="keywordtype">float</span> speed);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    int32 convertAccelTovTopsPerPeriodSqd(<span class="keywordtype">float</span> accel);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordtype">long</span> currentTimeInMillis();</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordtype">long</span> <span class="keywordtype">long</span> currentTimeInMicros();</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="classAsservInsa.html">AsservInsa</a>(<a class="code" href="classRobot.html">Robot</a> * robot);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    ~<a class="code" href="classAsservInsa.html">AsservInsa</a>();</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordtype">void</span> motion_Init(<span class="keywordtype">int</span> freq);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordtype">void</span> motion_SetSamplingFrequency(uint frequency);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a81c2ebb47e4d076df72b46dda9798828">path_CancelTrajectory</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#aef3d84dbdf3cf625978f25554202369e">path_InterruptTrajectory</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">void</span> path_CollisionOnTrajectory();</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordtype">void</span> path_CollisionRearOnTrajectory();</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">//motion</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordtype">void</span> motion_setGoalPosition(<span class="keywordtype">float</span> x_mm, <span class="keywordtype">float</span> y_mm); <span class="comment">//to calculate cap position</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a0a0e525f7c85b70e4643fd48a847da1e">odo_SetPosition</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> theta);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="structRobotPosition.html">RobotPosition</a> <a class="code" href="classAsservInsa.html#ad3ba1c750cbefac429d6901b579a61a8">odo_GetPosition</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordtype">float</span> pos_getX_mm();</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordtype">float</span> pos_getY_mm();</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordtype">float</span> pos_getTheta(); <span class="comment">// angle in radian</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordtype">float</span> pos_getThetaInDegree(); <span class="comment">// angle in degrees</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordtype">void</span> motion_setMaxPwmValue(<span class="keywordtype">int</span> maxPwmValue);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a185762af29296314354ebbeedf7d9f79">motion_configureAlphaPID</a>(<span class="keywordtype">float</span> p, <span class="keywordtype">float</span> i, <span class="keywordtype">float</span> d);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordtype">void</span> motion_configureDeltaPID(<span class="keywordtype">float</span> p, <span class="keywordtype">float</span> i, <span class="keywordtype">float</span> d);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordtype">void</span> motion_configureLeftPID(<span class="keywordtype">float</span> p, <span class="keywordtype">float</span> i, <span class="keywordtype">float</span> d);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="keywordtype">void</span> motion_configureRightPID(<span class="keywordtype">float</span> p, <span class="keywordtype">float</span> i, <span class="keywordtype">float</span> d);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#abfd039891e955c93bcfaf905d92ff03e">motion_FreeMotion</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#aa419b5594a43c9133b81b64ceac4e40f">motion_SetCurrentCommand</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *cmd);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#aaa40cb7703fd06105886f7d606edc719">motion_DisablePID</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a847f01f6565d04782ac49a64a8952e7d">motion_AssistedHandling</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#ac80c0e514cddf1dc5f3eade9fa5dd329">motion_StopTimer</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a4d839cdd298a4e24f57b5a298e6f463e">setPWM</a>(int16 pwmLeft, int16 pwmRight);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">//---encoder</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    uint32 encoder_GetLeftResolution();</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    uint32 encoder_GetRightResolution();</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#aa20ca7b484f54748a7fefda97b969a9f">encoder_Init</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#aca28ee0011e081ee43edc944d9dc67a3">encoder_SetDist</a>(<span class="keywordtype">float</span> dist);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a4b5dca46085bb5f955a71f5edc8374f2">encoder_SetResolution</a>(uint32 leftTicksPerM, uint32 rightTicksPerM, <span class="keywordtype">float</span> entraxe_mm);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a76cc56c8240ee5f95dd15f4d3097f9a7">encoder_ReadSensor</a>(int32 *dLeft,</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            int32 *dRight,</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            int32 *dAlpha,</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            int32 *dDelta,</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            int32 *left,</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            int32 *right);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">//---robot_traj_wrappers</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    TRAJ_STATE motion_findPidAD(<span class="keywordtype">float</span> angle_rad, <span class="keywordtype">float</span> meters, <span class="keywordtype">int</span> sec);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    TRAJ_STATE motion_findPidLR(<span class="keywordtype">float</span> posl, <span class="keywordtype">float</span> posr, <span class="keywordtype">int</span> sec);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    TRAJ_STATE <a class="code" href="classAsservInsa.html#a3cb6f1cf5557851312a8398b79514905">motion_DoLine</a>(<span class="keywordtype">float</span> dist);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    TRAJ_STATE <a class="code" href="classAsservInsa.html#ab45e49759207b2ba9abcb17b1d567abf">motion_DoRotate</a>(<span class="keywordtype">float</span> angle);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    TRAJ_STATE <a class="code" href="classAsservInsa.html#aa254f5473381b147ddaa536a1187fd5c">motion_DoArcRotate</a>(<span class="keywordtype">float</span> angle, <span class="keywordtype">float</span> radius);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#af139b79d3547a044dbf921e5984bc3cd">computeAlphaDelta</a>(<span class="keywordtype">float</span> x1,</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="keywordtype">float</span> y1,</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordtype">float</span> theta1,</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="keywordtype">float</span> x2,</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="keywordtype">float</span> y2,</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="keywordtype">float</span> *out_angle,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="keywordtype">float</span> *out_dist);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="preprocessor">#define motion_DoArcLeftForward(angle, radius) motion_DoArcRotate(fabs(angle), fabs(radius))</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="preprocessor">#define motion_DoArcRightForward(angle, radius) motion_DoArcRotate(-fabs(angle), -fabs(radius))</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="preprocessor">#define motion_DoArcLeftBackward(angle, radius) motion_DoArcRotate(-fabs(angle), fabs(radius))</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="preprocessor">#define motion_DoArcRightBackward(angle, radius) motion_DoArcRotate(fabs(angle), -fabs(radius))</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    TRAJ_STATE <a class="code" href="classAsservInsa.html#ad92a1afe85121d55bce7551cfab80bf5">motion_GoToTSLFrom</a>(<span class="keywordtype">float</span> x1, <span class="keywordtype">float</span> y1, <span class="keywordtype">float</span> theta1, <span class="keywordtype">float</span> x2, <span class="keywordtype">float</span> y2);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    TRAJ_STATE <a class="code" href="classAsservInsa.html#a878ef9649b7358b14adda88f336b9aab">motion_GoToTSL</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    TRAJ_STATE <a class="code" href="classAsservInsa.html#aade6e14a6fab69dd1f42391f5ca212ae">motion_GoToSpeed</a>(<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    TRAJ_STATE <a class="code" href="classAsservInsa.html#a2c7ff3570217f3bd521b780ac6e3b530">motion_GoToSpeedPath</a>(<span class="keyword">const</span> <a class="code" href="structPosition.html">Position</a> *pos, <span class="keywordtype">int</span> nb);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    TRAJ_STATE <a class="code" href="classAsservInsa.html#aea5aa879c72353a31b186a11a11ef08c">motion_OrientTo</a>(<span class="keywordtype">float</span> angle);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">//---robot_trajectory</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#ab0fe0ad459e394938598a8b031118edb">motion_Line</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd, <span class="keywordtype">float</span> dist);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#af0aa05c12a2d8eb278f84e1b7472ca83">motion_LineSpeed</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd, <span class="keywordtype">float</span> dist, <span class="keywordtype">float</span> VMax);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#af749fa1a3cefdb6593451a2ff4114bd8">motion_LineSpeedAcc</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="keywordtype">float</span> dist,</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="keywordtype">float</span> VMax,</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="keywordtype">float</span> Accel,</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <span class="keywordtype">float</span> Decel);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#ae7c7edab12c43ce352a694e95994c972">motion_Rotate</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd, <span class="keywordtype">float</span> angle);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a1c9e34ba184f7d4c651955185d022605">motion_RotateSpeed</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd, <span class="keywordtype">float</span> angle, <span class="keywordtype">float</span> VMax);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#ada416b12d072bc0a4bf6ecfebc0dcbc5">motion_RotateSpeedAcc</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <span class="keywordtype">float</span> angle,</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            <span class="keywordtype">float</span> VMax,</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            <span class="keywordtype">float</span> Accel,</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <span class="keywordtype">float</span> Decel);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#ad243e9562a5191e34aed076e52e8fab8">motion_ArcRotate</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd, <span class="keywordtype">float</span> angle, <span class="keywordtype">float</span> radius);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordtype">void</span> motion_ArcRotateSpeed(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd, <span class="keywordtype">float</span> angle, <span class="keywordtype">float</span> radius, <span class="keywordtype">float</span> VMax);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordtype">void</span> motion_ArcRotateSpeedAcc(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="keywordtype">float</span> angle,</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <span class="keywordtype">float</span> radius,</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="keywordtype">float</span> VMax,</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordtype">float</span> Accel,</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="keywordtype">float</span> Decel);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#ae70a0eb3fe9dab42d6fa1537ddcb6b8b">motion_SpeedControlLR</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <span class="keywordtype">float</span> spLeft,</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="keywordtype">float</span> distLeft,</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <span class="keywordtype">float</span> accLeft,</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordtype">float</span> spRight,</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="keywordtype">float</span> distRight,</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="keywordtype">float</span> accRight);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="keywordtype">void</span> motion_SpeedControlLRDecel(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <span class="keywordtype">float</span> spLeft,</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <span class="keywordtype">float</span> distLeft,</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            <span class="keywordtype">float</span> accLeft,</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <span class="keywordtype">float</span> decLeft,</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <span class="keywordtype">float</span> spRight,</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <span class="keywordtype">float</span> distRight,</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <span class="keywordtype">float</span> accRight,</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <span class="keywordtype">float</span> decRight);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordtype">void</span> motion_SpeedControlLRV0(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <span class="keywordtype">float</span> V0Left,</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <span class="keywordtype">float</span> spLeft,</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <span class="keywordtype">float</span> distLeft,</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordtype">float</span> accLeft,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="keywordtype">float</span> V0Right,</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <span class="keywordtype">float</span> spRight,</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            <span class="keywordtype">float</span> distRight,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordtype">float</span> accRight);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordtype">void</span> motion_SpeedControlLRTime(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <span class="keywordtype">float</span> V0Left,</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <span class="keywordtype">float</span> TLeft,</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            <span class="keywordtype">float</span> accLeft,</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            <span class="keywordtype">float</span> V0Right,</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="keywordtype">float</span> TRight,</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <span class="keywordtype">float</span> accRight);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#adeb7a8d4a160f8be0cfecbf721ca2c44">motion_SpeedControlAD</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            <span class="keywordtype">float</span> spAlpha,</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="keywordtype">float</span> distAlpha,</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="keywordtype">float</span> accAlpha,</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordtype">float</span> spDelta,</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <span class="keywordtype">float</span> distDelta,</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <span class="keywordtype">float</span> accDelta);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a949a94fc133abfb6ff87671372a510a8">motion_SpeedControlADMaxTime</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd,</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <span class="keywordtype">float</span> spAlpha,</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            <span class="keywordtype">float</span> accAlpha,</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            <span class="keywordtype">float</span> spDelta,</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            <span class="keywordtype">float</span> accDelta,</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="keywordtype">int</span> duringMs);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#a8237e3dcb0d9c8852f692c466da10f32">motion_StepOrderLR</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd, int32 posLeft, int32 posRight, <span class="keywordtype">int</span> seconds);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classAsservInsa.html#ab9a32335b1fe9484243f5849680fe510">motion_StepOrderAD</a>(<a class="code" href="structRobotCommand.html">RobotCommand</a> *out_cmd, int32 posAlpha, int32 posDelta, <span class="keywordtype">int</span> seconds);</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="comment">//void pos_SetPosition(float x, float y, float theta);</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keywordtype">float</span> motion_GetDefaultVmax();</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="keywordtype">float</span> motion_GetDefaultAccel();</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordtype">float</span> motion_GetDefaultDecel();</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordtype">void</span> motion_SetDefaultVmax(<span class="keywordtype">float</span> speed_m_sec); <span class="comment">//en m/s</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordtype">void</span> motion_SetDefaultAccel(<span class="keywordtype">float</span> accel);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="keywordtype">void</span> motion_SetDefaultDecel(<span class="keywordtype">float</span> decel);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;};</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="classutils_1_1Thread_html"><div class="ttname"><a href="classutils_1_1Thread.html">utils::Thread</a></div><div class="ttdoc">Cette classe encapsule l&amp;#39;implmentation des threads. </div><div class="ttdef"><b>Definition:</b> Thread.hpp:42</div></div>
<div class="ttc" id="classAsservInsa_html_ab0fe0ad459e394938598a8b031118edb"><div class="ttname"><a href="classAsservInsa.html#ab0fe0ad459e394938598a8b031118edb">AsservInsa::motion_Line</a></div><div class="ttdeci">void motion_Line(RobotCommand *out_cmd, float dist)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:32</div></div>
<div class="ttc" id="classAsservInsa_html_af0aa05c12a2d8eb278f84e1b7472ca83"><div class="ttname"><a href="classAsservInsa.html#af0aa05c12a2d8eb278f84e1b7472ca83">AsservInsa::motion_LineSpeed</a></div><div class="ttdeci">void motion_LineSpeed(RobotCommand *out_cmd, float dist, float VMax)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:42</div></div>
<div class="ttc" id="structpidSystemValues_html"><div class="ttname"><a href="structpidSystemValues.html">pidSystemValues</a></div><div class="ttdef"><b>Definition:</b> AsservInsa.hpp:140</div></div>
<div class="ttc" id="classAsservInsa_html_ae70a0eb3fe9dab42d6fa1537ddcb6b8b"><div class="ttname"><a href="classAsservInsa.html#ae70a0eb3fe9dab42d6fa1537ddcb6b8b">AsservInsa::motion_SpeedControlLR</a></div><div class="ttdeci">void motion_SpeedControlLR(RobotCommand *out_cmd, float spLeft, float distLeft, float accLeft, float spRight, float distRight, float accRight)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:169</div></div>
<div class="ttc" id="classAsservInsa_html_a4d839cdd298a4e24f57b5a298e6f463e"><div class="ttname"><a href="classAsservInsa.html#a4d839cdd298a4e24f57b5a298e6f463e">AsservInsa::setPWM</a></div><div class="ttdeci">void setPWM(int16 pwmLeft, int16 pwmRight)</div><div class="ttdoc">Directly set the pwm for the motor (used both internally and for test) </div><div class="ttdef"><b>Definition:</b> motion.cpp:692</div></div>
<div class="ttc" id="classRobot_html"><div class="ttname"><a href="classRobot.html">Robot</a></div><div class="ttdef"><b>Definition:</b> Robot.hpp:27</div></div>
<div class="ttc" id="structPositionCommand_html"><div class="ttname"><a href="structPositionCommand.html">PositionCommand</a></div><div class="ttdef"><b>Definition:</b> AsservInsa.hpp:160</div></div>
<div class="ttc" id="classAsservInsa_html_af139b79d3547a044dbf921e5984bc3cd"><div class="ttname"><a href="classAsservInsa.html#af139b79d3547a044dbf921e5984bc3cd">AsservInsa::computeAlphaDelta</a></div><div class="ttdeci">void computeAlphaDelta(float x1, float y1, float theta1, float x2, float y2, float *out_angle, float *out_dist)</div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:77</div></div>
<div class="ttc" id="classAsservInsa_html_a949a94fc133abfb6ff87671372a510a8"><div class="ttname"><a href="classAsservInsa.html#a949a94fc133abfb6ff87671372a510a8">AsservInsa::motion_SpeedControlADMaxTime</a></div><div class="ttdeci">void motion_SpeedControlADMaxTime(RobotCommand *out_cmd, float spAlpha, float accAlpha, float spDelta, float accDelta, int duringMs)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:186</div></div>
<div class="ttc" id="classAsservInsa_html_abfd039891e955c93bcfaf905d92ff03e"><div class="ttname"><a href="classAsservInsa.html#abfd039891e955c93bcfaf905d92ff03e">AsservInsa::motion_FreeMotion</a></div><div class="ttdeci">void motion_FreeMotion(void)</div><div class="ttdoc">Stop motion control for a moment. </div><div class="ttdef"><b>Definition:</b> motion.cpp:184</div></div>
<div class="ttc" id="classAsservInsa_html_aaa40cb7703fd06105886f7d606edc719"><div class="ttname"><a href="classAsservInsa.html#aaa40cb7703fd06105886f7d606edc719">AsservInsa::motion_DisablePID</a></div><div class="ttdeci">void motion_DisablePID(void)</div><div class="ttdoc">Stop motion control and disable PID. </div><div class="ttdef"><b>Definition:</b> motion.cpp:196</div></div>
<div class="ttc" id="classMovingBase_html"><div class="ttname"><a href="classMovingBase.html">MovingBase</a></div><div class="ttdef"><b>Definition:</b> MovingBase.hpp:13</div></div>
<div class="ttc" id="classAcceleration_html"><div class="ttname"><a href="classAcceleration.html">Acceleration</a></div><div class="ttdef"><b>Definition:</b> ccTypes.h:600</div></div>
<div class="ttc" id="classAsservInsa_html_a0a0e525f7c85b70e4643fd48a847da1e"><div class="ttname"><a href="classAsservInsa.html#a0a0e525f7c85b70e4643fd48a847da1e">AsservInsa::odo_SetPosition</a></div><div class="ttdeci">void odo_SetPosition(float x, float y, float theta)</div><div class="ttdoc">Set robot position used by odometry. </div><div class="ttdef"><b>Definition:</b> motion_calibration.cpp:71</div></div>
<div class="ttc" id="classAsservInsa_html_a76cc56c8240ee5f95dd15f4d3097f9a7"><div class="ttname"><a href="classAsservInsa.html#a76cc56c8240ee5f95dd15f4d3097f9a7">AsservInsa::encoder_ReadSensor</a></div><div class="ttdeci">void encoder_ReadSensor(int32 *dLeft, int32 *dRight, int32 *dAlpha, int32 *dDelta, int32 *left, int32 *right)</div><div class="ttdef"><b>Definition:</b> encoder.cpp:54</div></div>
<div class="ttc" id="classAsservInsa_html_ab45e49759207b2ba9abcb17b1d567abf"><div class="ttname"><a href="classAsservInsa.html#ab45e49759207b2ba9abcb17b1d567abf">AsservInsa::motion_DoRotate</a></div><div class="ttdeci">TRAJ_STATE motion_DoRotate(float angle)</div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:61</div></div>
<div class="ttc" id="structWAYPOINT_html"><div class="ttname"><a href="structWAYPOINT.html">WAYPOINT</a></div><div class="ttdoc">structure used to represent trajectory waypoint </div><div class="ttdef"><b>Definition:</b> AsservInsa.hpp:236</div></div>
<div class="ttc" id="classAsservInsa_html_af749fa1a3cefdb6593451a2ff4114bd8"><div class="ttname"><a href="classAsservInsa.html#af749fa1a3cefdb6593451a2ff4114bd8">AsservInsa::motion_LineSpeedAcc</a></div><div class="ttdeci">void motion_LineSpeedAcc(RobotCommand *out_cmd, float dist, float VMax, float Accel, float Decel)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:47</div></div>
<div class="ttc" id="classAsservInsa_html_a3cb6f1cf5557851312a8398b79514905"><div class="ttname"><a href="classAsservInsa.html#a3cb6f1cf5557851312a8398b79514905">AsservInsa::motion_DoLine</a></div><div class="ttdeci">TRAJ_STATE motion_DoLine(float dist)</div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:53</div></div>
<div class="ttc" id="structRobotPosition_html"><div class="ttname"><a href="structRobotPosition.html">RobotPosition</a></div><div class="ttdef"><b>Definition:</b> AAsservDriver.hpp:28</div></div>
<div class="ttc" id="classlogs_1_1LoggerFactory_html_a82585b5de73e471e06cafdccc3b3721e"><div class="ttname"><a href="classlogs_1_1LoggerFactory.html#a82585b5de73e471e06cafdccc3b3721e">logs::LoggerFactory::logger</a></div><div class="ttdeci">static const Logger &amp; logger(const std::string &amp;name)</div><div class="ttdoc">Cette mthode statique retourne un Logger en fonction de son nom. </div><div class="ttdef"><b>Definition:</b> LoggerFactory.cpp:56</div></div>
<div class="ttc" id="structMOTOR_html"><div class="ttname"><a href="structMOTOR.html">MOTOR</a></div><div class="ttdoc">structure used internally for stocking current value for each motors </div><div class="ttdef"><b>Definition:</b> AsservInsa.hpp:212</div></div>
<div class="ttc" id="classAsservInsa_html_aef3d84dbdf3cf625978f25554202369e"><div class="ttname"><a href="classAsservInsa.html#aef3d84dbdf3cf625978f25554202369e">AsservInsa::path_InterruptTrajectory</a></div><div class="ttdeci">void path_InterruptTrajectory(void)</div><div class="ttdef"><b>Definition:</b> path_manager.cpp:114</div></div>
<div class="ttc" id="classAsservInsa_html_a2c7ff3570217f3bd521b780ac6e3b530"><div class="ttname"><a href="classAsservInsa.html#a2c7ff3570217f3bd521b780ac6e3b530">AsservInsa::motion_GoToSpeedPath</a></div><div class="ttdeci">TRAJ_STATE motion_GoToSpeedPath(const Position *pos, int nb)</div><div class="ttdoc">Goto a list of (x,y) position using speed motion. </div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:124</div></div>
<div class="ttc" id="classAsservInsa_html_aa20ca7b484f54748a7fefda97b969a9f"><div class="ttname"><a href="classAsservInsa.html#aa20ca7b484f54748a7fefda97b969a9f">AsservInsa::encoder_Init</a></div><div class="ttdeci">void encoder_Init(void)</div><div class="ttdoc">Initialisation. </div><div class="ttdef"><b>Definition:</b> encoder.cpp:35</div></div>
<div class="ttc" id="classAsservInsa_html_aa419b5594a43c9133b81b64ceac4e40f"><div class="ttname"><a href="classAsservInsa.html#aa419b5594a43c9133b81b64ceac4e40f">AsservInsa::motion_SetCurrentCommand</a></div><div class="ttdeci">void motion_SetCurrentCommand(RobotCommand *cmd)</div><div class="ttdoc">Set a robot command and execute it. </div><div class="ttdef"><b>Definition:</b> motion.cpp:245</div></div>
<div class="ttc" id="classAsservInsa_html_ae7c7edab12c43ce352a694e95994c972"><div class="ttname"><a href="classAsservInsa.html#ae7c7edab12c43ce352a694e95994c972">AsservInsa::motion_Rotate</a></div><div class="ttdeci">void motion_Rotate(RobotCommand *out_cmd, float angle)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:79</div></div>
<div class="ttc" id="classAsservInsa_html_aca28ee0011e081ee43edc944d9dc67a3"><div class="ttname"><a href="classAsservInsa.html#aca28ee0011e081ee43edc944d9dc67a3">AsservInsa::encoder_SetDist</a></div><div class="ttdeci">void encoder_SetDist(float dist)</div><div class="ttdef"><b>Definition:</b> encoder.cpp:48</div></div>
<div class="ttc" id="classlogs_1_1Logger_html"><div class="ttname"><a href="classlogs_1_1Logger.html">logs::Logger</a></div><div class="ttdoc">Classe de gestion des traces de l&amp;#39;application. </div><div class="ttdef"><b>Definition:</b> Logger.hpp:63</div></div>
<div class="ttc" id="classAsservInsa_html_adeb7a8d4a160f8be0cfecbf721ca2c44"><div class="ttname"><a href="classAsservInsa.html#adeb7a8d4a160f8be0cfecbf721ca2c44">AsservInsa::motion_SpeedControlAD</a></div><div class="ttdeci">void motion_SpeedControlAD(RobotCommand *out_cmd, float spAlpha, float distAlpha, float accAlpha, float spDelta, float distDelta, float accDelta)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:286</div></div>
<div class="ttc" id="classAsservInsa_html_a81c2ebb47e4d076df72b46dda9798828"><div class="ttname"><a href="classAsservInsa.html#a81c2ebb47e4d076df72b46dda9798828">AsservInsa::path_CancelTrajectory</a></div><div class="ttdeci">void path_CancelTrajectory(void)</div><div class="ttdef"><b>Definition:</b> path_manager.cpp:105</div></div>
<div class="ttc" id="classAsservInsa_html_a878ef9649b7358b14adda88f336b9aab"><div class="ttname"><a href="classAsservInsa.html#a878ef9649b7358b14adda88f336b9aab">AsservInsa::motion_GoToTSL</a></div><div class="ttdeci">TRAJ_STATE motion_GoToTSL(float x, float y)</div><div class="ttdoc">Goto (x,y) using Turn-Stop-Line motion. </div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:209</div></div>
<div class="ttc" id="classAsservInsa_html_a4b5dca46085bb5f955a71f5edc8374f2"><div class="ttname"><a href="classAsservInsa.html#a4b5dca46085bb5f955a71f5edc8374f2">AsservInsa::encoder_SetResolution</a></div><div class="ttdeci">void encoder_SetResolution(uint32 leftTicksPerM, uint32 rightTicksPerM, float entraxe_mm)</div><div class="ttdef"><b>Definition:</b> motion_calibration.cpp:7</div></div>
<div class="ttc" id="structRobotCommand_html"><div class="ttname"><a href="structRobotCommand.html">RobotCommand</a></div><div class="ttdoc">structure used internally to define a robot trajectory command </div><div class="ttdef"><b>Definition:</b> AsservInsa.hpp:242</div></div>
<div class="ttc" id="classAsservInsa_html_a67295285fc3a26cb25c99a1f9a88db2c"><div class="ttname"><a href="classAsservInsa.html#a67295285fc3a26cb25c99a1f9a88db2c">AsservInsa::execute</a></div><div class="ttdeci">virtual void execute()</div><div class="ttdoc">L&amp;#39;implementation de cette mthode dtaille le traitement ralis par ce thread. </div><div class="ttdef"><b>Definition:</b> motion.cpp:270</div></div>
<div class="ttc" id="classAsservInsa_html_a1c9e34ba184f7d4c651955185d022605"><div class="ttname"><a href="classAsservInsa.html#a1c9e34ba184f7d4c651955185d022605">AsservInsa::motion_RotateSpeed</a></div><div class="ttdeci">void motion_RotateSpeed(RobotCommand *out_cmd, float angle, float VMax)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:85</div></div>
<div class="ttc" id="classAsservInsa_html_ad243e9562a5191e34aed076e52e8fab8"><div class="ttname"><a href="classAsservInsa.html#ad243e9562a5191e34aed076e52e8fab8">AsservInsa::motion_ArcRotate</a></div><div class="ttdeci">void motion_ArcRotate(RobotCommand *out_cmd, float angle, float radius)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:113</div></div>
<div class="ttc" id="classAsservInsa_html_aea5aa879c72353a31b186a11a11ef08c"><div class="ttname"><a href="classAsservInsa.html#aea5aa879c72353a31b186a11a11ef08c">AsservInsa::motion_OrientTo</a></div><div class="ttdeci">TRAJ_STATE motion_OrientTo(float angle)</div><div class="ttdoc">Orient toward the given angle. </div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:220</div></div>
<div class="ttc" id="structpidConfig_html"><div class="ttname"><a href="structpidConfig.html">pidConfig</a></div><div class="ttdef"><b>Definition:</b> AsservInsa.hpp:133</div></div>
<div class="ttc" id="classAsservInsa_html_ad3ba1c750cbefac429d6901b579a61a8"><div class="ttname"><a href="classAsservInsa.html#ad3ba1c750cbefac429d6901b579a61a8">AsservInsa::odo_GetPosition</a></div><div class="ttdeci">RobotPosition odo_GetPosition(void)</div><div class="ttdoc">Get current odometry robot position. </div><div class="ttdef"><b>Definition:</b> motion_calibration.cpp:82</div></div>
<div class="ttc" id="classAsservInsa_html"><div class="ttname"><a href="classAsservInsa.html">AsservInsa</a></div><div class="ttdef"><b>Definition:</b> AsservInsa.hpp:258</div></div>
<div class="ttc" id="structPosition_html"><div class="ttname"><a href="structPosition.html">Position</a></div><div class="ttdef"><b>Definition:</b> Position.hpp:19</div></div>
<div class="ttc" id="classAsservInsa_html_ad92a1afe85121d55bce7551cfab80bf5"><div class="ttname"><a href="classAsservInsa.html#ad92a1afe85121d55bce7551cfab80bf5">AsservInsa::motion_GoToTSLFrom</a></div><div class="ttdeci">TRAJ_STATE motion_GoToTSLFrom(float x1, float y1, float theta1, float x2, float y2)</div><div class="ttdoc">Goto (x2,y2) from (x1,y1,theta1) using Turn-Stop-Line motion. </div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:191</div></div>
<div class="ttc" id="classAsservInsa_html_ac80c0e514cddf1dc5f3eade9fa5dd329"><div class="ttname"><a href="classAsservInsa.html#ac80c0e514cddf1dc5f3eade9fa5dd329">AsservInsa::motion_StopTimer</a></div><div class="ttdeci">void motion_StopTimer(void)</div><div class="ttdoc">Stop motion control timer, used to shutdown motion control. </div><div class="ttdef"><b>Definition:</b> motion.cpp:680</div></div>
<div class="ttc" id="classAsservInsa_html_a8237e3dcb0d9c8852f692c466da10f32"><div class="ttname"><a href="classAsservInsa.html#a8237e3dcb0d9c8852f692c466da10f32">AsservInsa::motion_StepOrderLR</a></div><div class="ttdeci">void motion_StepOrderLR(RobotCommand *out_cmd, int32 posLeft, int32 posRight, int seconds)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:303</div></div>
<div class="ttc" id="structSpeedCommand_html"><div class="ttname"><a href="structSpeedCommand.html">SpeedCommand</a></div><div class="ttdef"><b>Definition:</b> AsservInsa.hpp:190</div></div>
<div class="ttc" id="classutils_1_1Thread_html_ada9233f3e669c925e9ed518201ad31cd"><div class="ttname"><a href="classutils_1_1Thread.html#ada9233f3e669c925e9ed518201ad31cd">utils::Thread::state</a></div><div class="ttdeci">ThreadState state()</div><div class="ttdoc">Cette mthode retourne l&amp;#39;tat du thread. </div><div class="ttdef"><b>Definition:</b> Thread.hpp:119</div></div>
<div class="ttc" id="classAsservInsa_html_ab9a32335b1fe9484243f5849680fe510"><div class="ttname"><a href="classAsservInsa.html#ab9a32335b1fe9484243f5849680fe510">AsservInsa::motion_StepOrderAD</a></div><div class="ttdeci">void motion_StepOrderAD(RobotCommand *out_cmd, int32 posAlpha, int32 posDelta, int seconds)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:316</div></div>
<div class="ttc" id="classAsservInsa_html_aade6e14a6fab69dd1f42391f5ca212ae"><div class="ttname"><a href="classAsservInsa.html#aade6e14a6fab69dd1f42391f5ca212ae">AsservInsa::motion_GoToSpeed</a></div><div class="ttdeci">TRAJ_STATE motion_GoToSpeed(float x, float y)</div><div class="ttdoc">Goto (x,y) using speed motion. </div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:115</div></div>
<div class="ttc" id="classAsservInsa_html_ada416b12d072bc0a4bf6ecfebc0dcbc5"><div class="ttname"><a href="classAsservInsa.html#ada416b12d072bc0a4bf6ecfebc0dcbc5">AsservInsa::motion_RotateSpeedAcc</a></div><div class="ttdeci">void motion_RotateSpeedAcc(RobotCommand *out_cmd, float angle, float VMax, float Accel, float Decel)</div><div class="ttdef"><b>Definition:</b> robot_trajectory.cpp:90</div></div>
<div class="ttc" id="classAsservInsa_html_aa254f5473381b147ddaa536a1187fd5c"><div class="ttname"><a href="classAsservInsa.html#aa254f5473381b147ddaa536a1187fd5c">AsservInsa::motion_DoArcRotate</a></div><div class="ttdeci">TRAJ_STATE motion_DoArcRotate(float angle, float radius)</div><div class="ttdef"><b>Definition:</b> robot_traj_wrappers.cpp:69</div></div>
<div class="ttc" id="classAsservInsa_html_a847f01f6565d04782ac49a64a8952e7d"><div class="ttname"><a href="classAsservInsa.html#a847f01f6565d04782ac49a64a8952e7d">AsservInsa::motion_AssistedHandling</a></div><div class="ttdeci">void motion_AssistedHandling(void)</div><div class="ttdoc">Assisted movement mode =) </div><div class="ttdef"><b>Definition:</b> motion.cpp:190</div></div>
<div class="ttc" id="classAsservInsa_html_a185762af29296314354ebbeedf7d9f79"><div class="ttname"><a href="classAsservInsa.html#a185762af29296314354ebbeedf7d9f79">AsservInsa::motion_configureAlphaPID</a></div><div class="ttdeci">void motion_configureAlphaPID(float p, float i, float d)</div><div class="ttdoc">Load motion control module. </div><div class="ttdef"><b>Definition:</b> motion_calibration.cpp:144</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
